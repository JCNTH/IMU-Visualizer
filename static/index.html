<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>IMUKBenchmark App</title>
    <base href="/static/">
    <link rel="stylesheet" href="style.css">

    <!-- Import map: defines where to get modules such as three -->
    <script type="importmap">
      {
        "imports": {
          "three": "https://cdn.jsdelivr.net/npm/three@0.175.0/build/three.module.js",
          "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.175.0/examples/jsm/"
        }
      }
    </script>
    
    <style>
      /* Basic styles for the whole page */
      body {
        margin: 0;
        font-family: sans-serif;
        background-color: #f0f0f0;
        display: flex;
        height: 100vh;
      }
      /* Left panel styling: takes some fixed width */
      #leftPanel {
        width: 40%;
        padding: 20px;
        background-color: #fff;
        overflow-y: auto;
      }
      /* Right panel styling: fills the remaining space */
      #rightPanel {
        flex: 1;
        position: relative;
        background-color: #222;
      }
      /* Container for the IMU visualizer (will hold the Three.js canvas and UI) */
      #imuContainer {
        width: 100%;
        height: 100%;
      }
      /* IMU placement UI – copied from your original imu_placement/index.html */
      #info {
        position: absolute;
        top: 10px;
        left: 10px;
        z-index: 10;
        background: rgba(255,255,255,0.95);
        padding: 10px;
        border-radius: 4px;
        max-width: 320px;
      }
      .sensor-button, .view-button {
        margin: 2px;
        padding: 4px 8px;
        border: none;
        border-radius: 4px;
        background-color: #696969;
        cursor: pointer;
      }
      .sensor-button.selected, .view-button.selected {
        background-color: #ff5555;
        color: white;
      }
      #info h3, #info h4 {
        margin: 4px 0;
      }
      #rotation-controls, #axes-definition, #view-selection {
        margin-top: 8px;
      }
      #rotation-controls label, #axes-definition label {
        display: block;
        margin-top: 4px;
      }
    </style>
  </head>
  <body>
    <!-- LEFT PANEL: Existing main app content -->
    <div id="leftPanel">
      <h1>IMUKBenchmark App</h1>
      
      <!-- Sensor Mapping Section -->
      <div class="section">
        <h3>
          Sensor ID 
          <span class="info-icon" data-info="Upload a text or CSV file (sensor_placement.txt) that maps sensor IDs (e.g., '00B4D7D3') to sensor positions.">ℹ</span>
        </h3>
        <input type="file" id="sensorIdUpload" accept=".csv,.txt" />
        <div id="mappingStatus" class="status-message"></div>
      </div>
      
      <!-- Calibration Tasks & Body Alignment Section -->
      <div class="section">
        <h3>
          Calibration Tasks &amp; Body Alignment 
          <span class="info-icon" data-info="For each calibration task, select multiple files containing sensor data.">ℹ</span>
        </h3>
        <label for="numCalibrationTasks">
          Number of Tasks:
          <input type="number" id="numCalibrationTasks" min="1" value="1" />
        </label>
        <button id="generateCalibrationTasksBtn">Generate</button>
        <div id="calibrationContainer"></div>
      </div>
      
      <!-- Main Task Section -->
      <div class="section">
        <h3>
          Main Task 
          <span class="info-icon" data-info="Upload the main task TXT files for running IK.">ℹ</span>
        </h3>
        <input type="file" id="mainTaskUpload" accept=".txt" multiple />
        <div id="mainTaskStatus" class="status-message"></div>
      </div>

      <!-- IK Parameters Section -->
      <div class="section">
        <h3>IK Parameters</h3>
        <div>
          <label for="setupSelector">Sensor Setup:</label>
          <select id="setupSelector">
            <option value="mm" selected>mm (Default)</option>
            <option value="hh">hh</option>
            <option value="ll">ll</option>
            <option value="ff">ff</option>
          </select>
        </div>
        <div>
          <label for="filterSelector">Filter Type:</label>
          <select id="filterSelector">
            <option value="Xsens" selected>Xsens (Default)</option>
            <option value="MAH">MAH</option>
            <option value="VQF">VQF</option>
            <option value="MAD">MAD</option>
            <option value="EKF">EKF</option>
          </select>
        </div>
        <div>
          <label for="dimSelector">Dimensions:</label>
          <select id="dimSelector">
            <option value="9D" selected>9D (Default)</option>
            <option value="6D">6D</option>
          </select>
        </div>
        <div>
          <label for="removeOffsetCheckbox">
            <input type="checkbox" id="removeOffsetCheckbox" checked>
            Remove Offset
          </label>
        </div>
      </div>
      
      <!-- Run IK Button -->
      <div class="section">
        <button id="runIkBtn">Run IK</button>
      </div>

      <!-- ────── NEW: Generate Video Button ────── -->
      <div class="section">
        <button id="generateVideoBtn" >Generate Video</button>
      </div>
     <!-- <div class="section">
      <button id="generateVideoBtn" disabled>Generate Video</button>
    </div> -->
    <!-- ─────────────────────────────────────── -->
    </div>

     
    
    <!-- RIGHT PANEL: IMU Placement -->
    <div id="rightPanel">
      <!-- IMU Placement UI header and controls -->
      <div id="info">
        <h3>Place IMU Sensor</h3>
        <p><strong>Select Sensor Type:</strong></p>
        <div id="sensor-type">
          <button id="btn-pelvis" class="sensor-button">Pelvis</button>
          <button id="btn-leftThigh" class="sensor-button">Left Thigh</button>
          <button id="btn-rightThigh" class="sensor-button">Right Thigh</button>
          <button id="btn-leftShank" class="sensor-button">Left Shank</button>
          <button id="btn-rightShank" class="sensor-button">Right Shank</button>
          <button id="btn-leftToes" class="sensor-button">Left Toes</button>
          <button id="btn-rightToes" class="sensor-button">Right Toes</button>
        </div>
        <hr>
        <div id="view-selection">
          <h4>Placement View (Informational Only)</h4>
          <button id="view-frontal" class="view-button">Frontal</button>
          <button id="view-lateral" class="view-button">Lateral</button>
          <button id="view-medial" class="view-button">Medial</button>
          <button id="view-posterior" class="view-button">Posterior</button>
        </div>
        <hr>
        <div id="rotation-controls">
          <h4>Rotation Fine-Tuning (°)</h4>
          <label>
            X: <input type="range" id="rot-x" min="0" max="360" value="0">
            <span id="rot-x-value">0</span>°
          </label>
          <label>
            Y: <input type="range" id="rot-y" min="0" max="360" value="0">
            <span id="rot-y-value">0</span>°
          </label>
          <label>
            Z: <input type="range" id="rot-z" min="0" max="360" value="0">
            <span id="rot-z-value">0</span>°
          </label>
        </div>
        <hr>
        <div id="axes-definition">
          <h4>Define Sensor Axes</h4>
          <label>Up Axis: 
            <select id="axis-up">
              <option value="X" selected>X</option>
              <option value="Y">Y</option>
              <option value="Z">Z</option>
            </select>
          </label>
          <label>Left Axis: 
            <select id="axis-left">
              <option value="Y" selected>Y</option>
              <option value="X">X</option>
              <option value="Z">Z</option>
            </select>
          </label>
          <label>Outward Axis: 
            <select id="axis-out">
              <option value="Z" selected>Z</option>
              <option value="X">X</option>
              <option value="Y">Y</option>
            </select>
          </label>
        </div>
      </div>
      <!-- Container for the Three.js canvas -->
      <div id="imuContainer" style="width:100%; height:100%;"></div>
    </div>
    
    <!-- Custom Modal Window -->
    <div id="customModal" class="modal">
      <div class="modal-content">
        <h2 class="modal-title"></h2>
        <div id="modalMessage"></div>
        <button id="closeModalBtn">Close</button>
      </div>
    </div>

    <!-- If this element is already in your HTML, you don't need to add it again -->
    <div id="videoProgressWrapper" style="display:none; margin:20px 0; padding:10px; background-color:#f5f5f5; border-radius:4px;">
      <p style="margin:0 0 8px 0; font-weight:bold;">Generating Video:</p>
      <div style="display:flex; align-items:center;">
        <progress id="videoProgress" value="0" max="100" style="flex:1; height:20px;"></progress>
        <span id="videoPct" style="margin-left:10px; min-width:40px; text-align:right;">0%</span>
      </div>
    </div>
    
    <!-- Scripts -->
    <script type="module" src="script.js"></script>
    <script type="module" src="imu_placement/main.js"></script>
  </body>
</html>
